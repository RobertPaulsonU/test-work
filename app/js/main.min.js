const cart=document.querySelector(".header__actions-dropdown");let prices=[],quantities=[],allCardsStr=[],cardsStr={};function documentActions(e){const t=e.target;if((t.classList.contains("cart-icon")||t.closest(".cart-icon"))&&(e.preventDefault(),cart.classList.toggle("_active")),t.classList.contains("shop-btn")){const n=t.closest(".item-catalog").dataset.pid;e.preventDefault(),addToCart(n),checkCardItems(),calcPrices(),setItemsToLocalStorage()}if(t.classList.contains("reset-link")&&(e.preventDefault(),deleteAllCartItems(),localStorage.removeItem("cards"),t.style.display="none"),t.classList.contains("cart-list__delete")){const n=t.closest(".list-actions__item").dataset.cartPid;e.preventDefault(),addToCart(n,!1),calcPrices(),setItemsToLocalStorage()}}function addToCart(e,t=!0){const n=document.querySelector(".cart-icon"),s=n.querySelector("span"),a=document.querySelector(`[data-cart-pid="${e}"]`),c=document.querySelector(".list-actions");if(t)if(s?s.innerHTML=++s.innerHTML:n.insertAdjacentHTML("beforeend","<span>1</span>"),a){const e=a.querySelector(".list-actions__quantity span");e.innerHTML=++e.innerHTML}else{const t=document.querySelector(`[data-pid="${e}"]`),n=`\n            <a href="#" class="list-actions__image">${t.querySelector(".item-catalog__image").innerHTML}</a>\n            <div class="list-actions__body">\n            <a class="list-actions__title" href"#">${t.querySelector(".item-catalog__title").innerHTML}</a>\n            <div class="list-actions__price">${t.querySelector(".item-catalog__price").innerHTML}</div>\n            <div class="list-actions__quantity">Кількість: <span>1</span></div>\n            <a class="cart-list__delete" href="#">Видалити</a>\n            </div>\n            `;c.insertAdjacentHTML("beforeend",`<li data-cart-pid="${e}" class="list-actions__item">${n}</li>`)}else{const e=a.querySelector(".list-actions__quantity span");e.innerHTML=--e.innerHTML,parseInt(e.innerHTML)||a.remove();const t=--s.innerHTML;t?s.innerHTML=t:(s.remove(),document.querySelector(".reset-link").style.display="none",removeResaultSumm())}}function checkCardItems(){const e=cart.querySelectorAll(".cart-list__item"),t=document.querySelector(".reset-link");t.style.display=e?"block":"none"}function deleteAllCartItems(){const e=cart.querySelectorAll(".list-actions__item");mainQuantity=document.querySelector(".cart-icon span"),e.forEach((e=>e.remove())),mainQuantity.remove(),removeResaultSumm()}function calcPrices(){prices=[],quantities=[];document.querySelectorAll(".list-actions__item").forEach((e=>getValues(e)));const e=sumArrayElements(quantities);insertResault(sumArrayElements(prices),e)}function getValues(e){const t=e.querySelector(".list-actions__quantity span").innerHTML,n=e.querySelector(".list-actions__price").innerHTML,s=parseInt(n.replace(/[^0-9]+/g,"")),a=parseInt(t);let c=a*s;prices.push(c),quantities.push(a)}function sumArrayElements(e){return e.reduce(((e,t)=>e+t),0)}function insertResault(e,t){if(t>0){document.querySelector(".header__actions-info").innerHTML=`Кількість : ${t} (${e}$)`}else removeResaultSumm()}function removeResaultSumm(){document.querySelector(".header__actions-info").innerHTML="Кошик пустий (0 грн)"}function setItemsToLocalStorage(){cardsStr={},localStorage.removeItem("cards");document.querySelectorAll(".list-actions__item").forEach((e=>{let t=e.innerHTML,n=e.dataset.cartPid;cardsStr[n]=t})),localStorage.setItem("cards",JSON.stringify(cardsStr))}function getItemsFromLocalStorage(){const e=JSON.parse(localStorage.getItem("cards"));for(const t in e){generateItemsFromStorage(t,e[t])}}function generateItemsFromStorage(e,t){document.querySelector(".list-actions").insertAdjacentHTML("beforeend",`<li data-cart-pid="${e}" class="list-actions__item">${t}</li>`)}function setAllElemsOnload(){const e=sumArrayElements(quantities);if(e>0){document.querySelector(".cart-icon").insertAdjacentHTML("beforeend",`<span>${e}</span>`),document.querySelector(".reset-link").style.display="block"}}window.onload=function(){document.addEventListener("click",documentActions),getItemsFromLocalStorage(),calcPrices(),setAllElemsOnload()};